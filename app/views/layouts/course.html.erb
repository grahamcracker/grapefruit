<% content_for :home_content do %>

<div class="page-header-container">
  <div class="page-header">
    <div class="page-header-left">
      <h2 class="title"><%= link_to @course.name, course_path(@course) %></h2>
      <% if can? :manage, @course %>
        <p class="description">You are the instructor for this course.</p>
      <% end %>
    </div>
    <div class="page-header-right">
      <ul class="course-details">
        <li class="course-details-number"><%= @course.subject %> <%= @course.course_number %> <h6>COURSE NUMBER</h6></li>
        <li class="course-details-seats"><%= @course.seats_left %> <h6>SEATS</h6></li>
        <li class="course-details-credits"><%= @course.credits %> <h6>CREDITS</h6></li>
      </ul>
      <ul class="course-actions">
        <% if can? :manage, @course %>
          <li><%= link_to "Add Capsule", new_course_capsule_path(@course), class: "button small" %></li>
          <li><%= link_to "Add File", new_course_document_path(@course), class: "button small" %></li>
          <li><%= link_to "Preview Homework", course_webwork_path(@course), class: "button small" %></li>
          <li><%= link_to "Edit Course", edit_course_path(@course), class: "button small" %></li>
        <% else %>
          <% if @course.students.include?(current_user) %>
            <li><%= link_to "Do Homework", course_webwork_path(@course), class: "button small" %></li>
          <% else %>
            <%= form_for [@course, @course_user] do |f| %>
              <%= f.hidden_field :course_id, value: @course.id %>
              <%= f.hidden_field :user_id, value: current_user.id %>
              <%= f.submit "Enroll", class: "stateful-button--inactive" %>
            <% end %>
          <% end %>
        <% end %>
      </ul>
    </div>
  </div>
</div>

<section class="course">
  <aside>
    <ul class="course-accordion">
      <%= render @capsules %>
      <% if @capsules.empty? %>
        <li class="course-capsule">
          <div class="capsule-header">
            <h1 class="capsule-name">No capsules yet!</h1>
          </div>
        </li>
      <% end %>
    </ul>
  </aside>
  <div class="workplace">
    <%= yield %>
  </div>
</section>

<% end %>

<% content_for :left_sidebar do %>
<ul class="course-accordion--mobile">
  <%= render @capsules %>
</ul>
<% end %>

<% content_for :scripts do %>

<script>
capsule_names = $(".capsule-name");
for (var i = capsule_names.length - 1; i >= 0; i--) {
  if($(capsule_names[i]).clone().children().remove().end().text().length > 25){
    $(capsule_names[i]).addClass("long");
  }
};
</script>

<% end %>

<%= render template: 'layouts/home' %>